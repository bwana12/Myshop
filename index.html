<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShopEasy | Premium Shopping Malawi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { 
            --primary: #e42c64; 
            --secondary: #2a9dcc; 
            --dark: #0f172a; 
            --shadow: 0 8px 32px rgba(0,0,0,0.1); 
            --glass: rgba(255, 255, 255, 0.7);
            --success: #10b981; 
            --warning: #f59e0b;
            --bg: #f3f4f6;
            --card: #ffffff;
            --text: #1e293b;
            --border: rgba(226, 232, 240, 0.8);
            --star: #fbbf24;
            --sale: linear-gradient(135deg, #ff0080 0%, #7928ca 100%);
            --accent-glow: 0 0 15px rgba(228, 44, 100, 0.3);
        }

        body.dark-mode {
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f8fafc;
            --border: #334155;
            --glass: rgba(30, 41, 59, 0.8);
            --shadow: 0 8px 32px rgba(0,0,0,0.4);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', 'Segoe UI', sans-serif; scroll-behavior: smooth; }
        
        body { 
            background: var(--bg); 
            color: var(--text); 
            padding-bottom: 80px; 
            overflow-x: hidden; 
            transition: background 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
        }

        /* --- FUTURISTIC NAVIGATION --- */
        nav { 
            background: var(--glass); 
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 15px 5%; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            position: sticky; 
            top: 0; 
            z-index: 100; 
            border-bottom: 1px solid var(--border);
        }

        .logo { 
            font-size: 26px; 
            font-weight: 800; 
            background: var(--sale);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -1px;
        }

        .nav-icons { display: flex; align-items: center; gap: 20px; }
        
        .nav-icons div {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            background: var(--card);
            box-shadow: var(--shadow);
            transition: 0.3s;
        }

        .nav-icons div:hover { transform: translateY(-3px); color: var(--primary); }

        /* --- DYNAMIC CATEGORY GRID --- */
        .cat-icons-grid { 
            display: flex; 
            gap: 20px; 
            padding: 25px 5%; 
            overflow-x: auto; 
            scrollbar-width: none; 
            background: transparent; 
        }

        .cat-item-icon { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 10px; 
            cursor: pointer; 
            min-width: 80px; 
            transition: 0.4s; 
        }

        .cat-item-icon i { 
            width: 60px; 
            height: 60px; 
            background: var(--card); 
            border-radius: 20px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: var(--secondary); 
            font-size: 22px; 
            box-shadow: var(--shadow);
            transition: 0.3s;
        }

        .cat-item-icon span { font-size: 12px; font-weight: 600; opacity: 0.8; }

        .cat-item-icon:hover i { 
            background: var(--primary); 
            color: white; 
            transform: scale(1.1) rotate(5deg);
            box-shadow: var(--accent-glow);
        }

        /* --- NEUMORPHIC SEARCH --- */
        .search-section { padding: 10px 5%; }
        .search-box { position: relative; max-width: 600px; margin: 0 auto; }
        .search-box input { 
            width: 100%; 
            padding: 15px 55px 15px 25px; 
            border-radius: 18px; 
            border: 1px solid var(--border); 
            outline: none; 
            font-size: 16px; 
            background: var(--card); 
            color: var(--text); 
            box-shadow: var(--shadow);
        }

        /* --- PRODUCT CARDS --- */
        .products-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(170px, 1fr)); 
            gap: 20px; 
            margin-top: 20px;
        }

        .product-card { 
            background: var(--card); 
            border-radius: 24px; 
            overflow: hidden; 
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid var(--border); 
            position: relative; 
            box-shadow: var(--shadow);
        }

        .product-card:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(0,0,0,0.15); }

        .p-img { width: 100%; height: 180px; object-fit: cover; transition: 0.5s; }
        .product-card:hover .p-img { transform: scale(1.1); }

        .sale-badge { 
            position: absolute; top: 12px; left: 12px; 
            background: var(--sale); color: white; 
            padding: 5px 12px; border-radius: 10px; 
            font-size: 11px; font-weight: 800; z-index: 5; 
            animation: pulse-glow 2s infinite;
        }

        @keyframes pulse-glow {
            0% { box-shadow: 0 0 0 0 rgba(228, 44, 100, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(228, 44, 100, 0); }
            100% { box-shadow: 0 0 0 0 rgba(228, 44, 100, 0); }
        }

        /* --- FUTURISTIC BUTTONS --- */
        .btn-buy { 
            background: var(--dark); 
            color: white; 
            border: none; 
            width: 100%; 
            padding: 12px; 
            border-radius: 14px; 
            cursor: pointer; 
            font-weight: 700; 
            transition: 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 11px;
        }

        .btn-buy:hover { background: var(--primary); box-shadow: var(--accent-glow); }

        /* --- BOTTOM NAV BAR (NEW) --- */
        .bottom-nav {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 400px;
            background: var(--dark);
            border-radius: 25px;
            display: flex;
            justify-content: space-around;
            padding: 15px;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .bottom-nav i { color: #94a3b8; font-size: 20px; cursor: pointer; transition: 0.3s; }
        .bottom-nav i:hover, .bottom-nav i.active { color: var(--primary); transform: scale(1.2); }

        /* Existing Modal & Cart Sidebar refinements for "Futuristic" look */
        #cart-sidebar { 
            backdrop-filter: blur(20px); 
            background: var(--glass);
            border-left: 1px solid var(--border);
        }

        .modal-content {
            border-radius: 30px;
            border: 1px solid var(--border);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body id="top">

    <nav>
        <div class="logo"><i class="fas fa-bolt"></i> ShopEasy.</div>
        <div class="nav-icons">
            <div class="theme-icon" onclick="toggleTheme()"><i class="fas fa-moon" id="theme-icon"></i></div>
            <div class="share-icon" onclick="shareStore()"><i class="fas fa-rocket"></i></div>
            <div class="cart-icon" onclick="toggleCart()" style="background: var(--primary); color: white;">
                <i class="fas fa-shopping-bag"></i>
                <span class="cart-count" id="cart-count">0</span>
            </div>
        </div>
    </nav>

    <div class="cat-icons-grid">
        <div class="cat-item-icon" onclick="filterProducts('All', null)"><i class="fas fa-border-all"></i><span>Everything</span></div>
        <div class="cat-item-icon" onclick="filterProducts('Electronics', null)"><i class="fas fa-microchip"></i><span>Gadgets</span></div>
        <div class="cat-item-icon" onclick="filterProducts('Fashion', null)"><i class="fas fa-crown"></i><span>Fashion</span></div>
        <div class="cat-item-icon" onclick="filterProducts('Home', null)"><i class="fas fa-couch"></i><span>Living</span></div>
        <div class="cat-item-icon" onclick="filterProducts('Beauty', null)"><i class="fas fa-magic"></i><span>Glow</span></div>
    </div>

    <div class="search-section">
        <div class="search-box">
            <input type="text" id="search-input" placeholder="Find your desire..." onkeyup="handleSearch()">
            <i class="fas fa-search" style="position: absolute; right: 25px; top: 18px; color: var(--secondary);"></i>
        </div>
    </div>

    <div id="featured-section-ui">
        <h3 class="featured-title">âœ¨ Trending Now</h3>
        <div class="featured-container" id="featured-list"></div>
    </div>

    <div class="filter-container">
        <button class="filter-btn active" onclick="filterProducts('All', this)">All Items</button>
        <button class="filter-btn" onclick="filterProducts('Electronics', this)">Electronics</button>
        <button class="filter-btn" onclick="filterProducts('Fashion', this)">Fashion</button>
        <button class="filter-btn" onclick="filterProducts('Home', this)">Home</button>
        <button class="filter-btn" onclick="filterProducts('Beauty', this)">Beauty</button>
    </div>

    <div class="container">
        <div class="products-grid" id="store-container"></div>
    </div>

    <div class="bottom-nav">
        <i class="fas fa-home active" onclick="window.scrollTo(0,0)"></i>
        <i class="fas fa-search" onclick="document.getElementById('search-input').focus()"></i>
        <i class="fas fa-heart"></i>
        <i class="fas fa-user"></i>
    </div>

    <div class="testimonials">
        <h3>What Our Customers Say</h3>
        <div class="test-grid">
            <div class="test-card"><p>"Fast delivery in Blantyre! The quality exceeded my expectations."</p><h4>- Kondwani M.</h4></div>
            <div class="test-card"><p>"Best prices for electronics in Malawi. Highly recommend."</p><h4>- Sarah P.</h4></div>
            <div class="test-card"><p>"Responsive customer service. Got my order the next day."</p><h4>- Isaac T.</h4></div>
        </div>
    </div>

    <div class="newsletter">
        <h3>Join the ShopEasy Club!</h3>
        <p>Get exclusive deals and first access to new stock in Malawi.</p>
        <div class="news-box">
            <input type="email" id="news-email" placeholder="Your email address">
            <button onclick="subscribeNews()">Join</button>
        </div>
    </div>

    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div class="zoom-container" id="zoom-area">
                <img id="modal-img" src="" onerror="this.src='https://via.placeholder.com/400'">
            </div>
            <div id="modal-rating" class="rating"></div>
            <h3 id="modal-name"></h3>
            <p id="modal-price"></p>
            <p id="modal-desc"></p>
            <button id="modal-add-btn" class="btn-buy">Add to Cart</button>
        </div>
    </div>

    <div class="contact-fab">
        <div class="fab-options">
            <a href="https://wa.me/265899195843" class="opt wa" target="_blank"><i class="fab fa-whatsapp"></i></a>
            <a href="tel:265899195843" class="opt ph"><i class="fas fa-phone"></i></a>
        </div>
        <div class="fab-btn"><i class="fas fa-comment-dots"></i></div>
    </div>

    <div id="cart-sidebar">
        <div class="cart-header">
            <button class="back-shopping-btn" onclick="toggleCart()"><i class="fas fa-chevron-left"></i></button>
            <h3>My Universe</h3>
        </div>
        <div id="cart-items-list"></div>
        <div class="promo-box">
            <input type="text" id="promo-input" placeholder="PROMO CODE">
            <button class="promo-btn" onclick="applyPromo()">Apply</button>
        </div>
        <div style="margin-top:20px;">
            <p>Total: MK <span id="cart-total">0</span></p>
            <button id="proceed-btn" class="btn-buy" style="background:var(--primary); margin-top:10px;" onclick="showCheckoutFields()">Checkout</button>
            <div id="final-fields" style="display:none;">
                <input type="text" id="cust-name" placeholder="Full Name" style="width:100%; padding:12px; margin-top:10px;">
                <button class="btn-buy" style="margin-top:10px; background:#25D366;" onclick="checkout()">WhatsApp Order</button>
            </div>
        </div>
    </div>

    <script type="module">
        // ALL ORIGINAL FIREBASE AND LOGIC FUNCTIONS REMAIN UNCHANGED BELOW
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDwhyU5BrtjRhy-45rd5oYfzGO8abehUiM",
            authDomain: "shopeasy-14890.firebaseapp.com",
            projectId: "shopeasy-14890",
            storageBucket: "shopeasy-14890.firebasestorage.app",
            messagingSenderId: "45827037951",
            appId: "1:45827037951:web:545d41703780fa51018aca"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let allProducts = [];
        let cart = [];
        let discountPercent = 0;
        let currentModalQty = 1; 
        let currentActivePrice = 0;
        const MY_PHONE = "265899195843"; 

        window.toggleTheme = () => {
            const body = document.body;
            body.classList.toggle('dark-mode');
            const icon = document.getElementById('theme-icon');
            icon.className = body.classList.contains('dark-mode') ? 'fas fa-sun' : 'fas fa-moon';
            localStorage.setItem('theme', body.classList.contains('dark-mode') ? 'dark' : 'light');
        };

        if (localStorage.getItem('theme') === 'dark') toggleTheme();

        onSnapshot(query(collection(db, "products"), orderBy("timestamp", "desc")), (snapshot) => {
            allProducts = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
            renderProducts(allProducts);
            renderFeatured(allProducts);
        });

        window.subscribeNews = async () => {
            const email = document.getElementById('news-email').value.trim();
            if(!email.includes('@')) return alert("Enter valid email.");
            try {
                await addDoc(collection(db, "newsletter"), { email: email, timestamp: Date.now() });
                alert("Subscribed!");
                document.getElementById('news-email').value = "";
            } catch (e) { alert("Error."); }
        };

        window.shareStore = () => {
            if (navigator.share) navigator.share({ title: 'ShopEasy', url: window.location.href });
            else { navigator.clipboard.writeText(window.location.href); alert("Link copied!"); }
        };

        function renderFeatured(list) {
            document.getElementById('featured-list').innerHTML = list.slice(0, 4).map(p => `
                <div class="featured-item" onclick="showDetailsByID('${p.id}')">
                    <img src="${p.image}" onerror="this.src='https://via.placeholder.com/200'">
                    <div class="featured-info"><p>${p.name}</p><small>MK ${Number(p.price).toLocaleString()}</small></div>
                </div>`).join('');
        }

        function renderProducts(list) {
            const cont = document.getElementById('store-container');
            cont.innerHTML = "";
            list.forEach(p => {
                const isSale = (p.bulkPrice && p.bulkPrice < p.price);
                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    ${isSale ? '<div class="sale-badge">SALE</div>' : ''}
                    <img src="${p.image}" class="p-img" onerror="this.src='https://via.placeholder.com/200'">
                    <div class="p-info">
                        <div class="rating"><i class="fas fa-star"></i> 4.8</div>
                        <p class="p-name">${p.name}</p>
                        <p class="p-price">MK ${Number(p.price).toLocaleString()}</p>
                        <button class="btn-buy" onclick="event.stopPropagation(); addToCart('${p.id}')">Add to Cart</button>
                    </div>`;
                card.onclick = () => showDetails(p, "4.8");
                cont.appendChild(card);
            });
        }

        window.addToCart = (id, specificQty = 1) => {
            const existing = cart.find(i => i.id === id);
            if(existing) existing.qty += specificQty;
            else cart.push({ ...allProducts.find(p => p.id === id), qty: specificQty });
            updateCartUI();
        };

        window.changeQty = (id, delta) => {
            const item = cart.find(i => i.id === id);
            if (item) {
                item.qty += delta;
                if (item.qty <= 0) cart = cart.filter(i => i.id !== id);
                updateCartUI();
            }
        };

        window.updateCartUI = () => {
            let subtotal = 0;
            document.getElementById('cart-count').innerText = cart.reduce((s, i) => s + i.qty, 0);
            document.getElementById('cart-items-list').innerHTML = cart.map(i => {
                const currentPrice = i.price;
                subtotal += currentPrice * i.qty;
                return `<div class="cart-item">
                    <div><b>${i.name}</b><br><small>MK ${(currentPrice * i.qty).toLocaleString()}</small></div>
                    <div class="qty-box">
                        <button class="qty-btn" onclick="changeQty('${i.id}', -1)">-</button>
                        <span>${i.qty}</span>
                        <button class="qty-btn" onclick="changeQty('${i.id}', 1)">+</button>
                    </div>
                </div>`;
            }).join("");
            document.getElementById('cart-total').innerText = subtotal.toLocaleString();
            document.getElementById('proceed-btn').style.display = cart.length > 0 ? 'block' : 'none';
        };

        window.checkout = async () => {
            const name = document.getElementById('cust-name').value.trim();
            if(!name || !cart.length) return alert("Enter name!");
            let itemsText = cart.map(i => `- ${i.name} (x${i.qty})`).join("%0A");
            window.open(`https://wa.me/${MY_PHONE}?text=*Order from ${name}*%0A${itemsText}`, '_blank');
        };

        window.handleSearch = () => {
            const q = document.getElementById('search-input').value.toLowerCase();
            renderProducts(allProducts.filter(p => p.name.toLowerCase().includes(q)));
        };

        window.showDetails = (p, rating) => {
            document.getElementById('modal-img').src = p.image;
            document.getElementById('modal-name').innerText = p.name;
            document.getElementById('modal-price').innerText = "MK " + Number(p.price).toLocaleString();
            document.getElementById('modal-desc').innerText = p.description || "";
            document.getElementById('modal-add-btn').onclick = () => { addToCart(p.id, 1); closeModal(); };
            document.getElementById('productModal').style.display = 'flex';
        };

        window.showDetailsByID = (id) => showDetails(allProducts.find(item => item.id === id), "4.9");
        window.closeModal = () => document.getElementById('productModal').style.display = 'none';
        window.toggleCart = () => document.getElementById('cart-sidebar').classList.toggle('active');
        window.filterProducts = (cat, btn) => {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');
            renderProducts(cat === 'All' ? allProducts : allProducts.filter(p => p.category === cat));
        };
    </script>
</body>
</html>
