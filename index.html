<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ShopEasy Malawi | Flash Sale Live!</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary-color: #e42c64; --secondary-color: #2a9dcc; --whatsapp-color: #25D366; --star: #ffc107; --shadow: 0 10px 25px rgba(0,0,0,0.08); }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Roboto, sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: #f8f9fa; padding-bottom: 80px; }
        
        /* Flash Sale Timer Bar */
        .timer-bar { background: linear-gradient(90deg, #ff0000, #e42c64); color: white; text-align: center; padding: 10px; font-size: 13px; font-weight: bold; display: flex; justify-content: center; align-items: center; gap: 10px; position: sticky; top: 0; z-index: 1100; }
        #countdown { background: rgba(0,0,0,0.2); padding: 2px 8px; border-radius: 5px; letter-spacing: 1px; }

        header { background: white; position: sticky; top: 40px; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.05); padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 22px; font-weight: 800; color: var(--primary-color); text-decoration: none; }
        .logo span { color: var(--secondary-color); }

        /* Category Bar */
        .cat-bar { display: flex; overflow-x: auto; gap: 10px; padding: 15px; background: white; white-space: nowrap; border-bottom: 1px solid #eee; }
        .cat-bar::-webkit-scrollbar { display: none; }
        .cat-btn { padding: 8px 20px; border-radius: 20px; border: 1px solid #ddd; background: white; font-size: 13px; font-weight: 600; cursor: pointer; }
        .cat-btn.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }

        /* Grid */
        .products-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 12px; }
        .product-card { background: white; border-radius: 16px; overflow: hidden; box-shadow: var(--shadow); position: relative; border: 1px solid #eee; transition: 0.3s; }
        .flash-tag { position: absolute; top: 8px; left: 8px; background: #ff0000; color: white; font-size: 9px; padding: 3px 8px; border-radius: 4px; font-weight: bold; z-index: 5; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }

        .product-img { width: 100%; height: 170px; object-fit: cover; }
        .product-info { padding: 12px; }
        .price { color: var(--primary-color); font-size: 17px; font-weight: 800; }
        .old-price { font-size: 11px; text-decoration: line-through; color: #888; margin-left: 5px; }

        /* Slide Panel */
        #detail-panel { position: fixed; bottom: -100%; left: 0; width: 100%; height: 85vh; background: white; z-index: 4000; transition: 0.4s cubic-bezier(0.25, 1, 0.5, 1); border-radius: 25px 25px 0 0; box-shadow: 0 -10px 40px rgba(0,0,0,0.3); overflow-y: auto; }
        #detail-panel.active { bottom: 0; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; z-index: 3500; }
        .overlay.active { display: block; }
        
        .add-btn { background: var(--primary-color); color: white; border: none; width: 100%; padding: 15px; border-radius: 12px; font-weight: bold; cursor: pointer; }
        
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 1px solid #eee; display: flex; justify-content: space-around; padding: 12px 0; z-index: 3000; }
        .nav-item { text-align: center; color: #777; text-decoration: none; font-size: 10px; }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 2px; }
    </style>
</head>
<body>

    <div class="timer-bar">
        <span>⚡ FLASH SALE ENDS IN: </span>
        <span id="countdown">00:00:00</span>
    </div>

    <header>
        <a href="#" class="logo">Shop<span>Easy</span></a>
        <div style="display:flex; gap:15px;"><i class="fas fa-search"></i><i class="fas fa-heart"></i></div>
    </header>

    <div class="cat-bar" id="category-bar">
        <button class="cat-btn active" onclick="filterCat('All', this)">All Deals</button>
        <button class="cat-btn" onclick="filterCat('Electronics', this)">Electronics</button>
        <button class="cat-btn" onclick="filterCat('Fashion', this)">Fashion</button>
        <button class="cat-btn" onclick="filterCat('Home', this)">Home</button>
    </div>

    <div class="products-grid" id="products-container"></div>

    <div id="detail-panel">
        <div onclick="closeDetails()" style="position:absolute; top:15px; right:20px; font-size:30px;">&times;</div>
        <img id="d-img" src="" style="width:100%; height:300px; object-fit:cover;">
        <div style="padding:20px;">
            <div style="color:#ff0000; font-weight:bold; font-size:12px; margin-bottom:10px;"><i class="fas fa-fire"></i> High Demand: 45 people bought this today</div>
            <h1 id="d-name" style="font-size:22px;"></h1>
            <div id="d-price" class="price" style="font-size:26px; margin:10px 0;"></div>
            <p id="d-desc" style="color:#666; font-size:14px; line-height:1.6;"></p>
            <div style="display:grid; grid-template-columns: 1fr 2fr; gap:10px; margin-top:30px;">
                <button onclick="whatsappChat()" class="add-btn" style="background:var(--whatsapp-color);"><i class="fab fa-whatsapp"></i> Chat</button>
                <button id="d-add-btn" class="add-btn">Add to Cart</button>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <a href="#" class="nav-item" style="color:var(--primary-color)"><i class="fas fa-bolt"></i>Deals</a>
        <a href="javascript:void(0)" onclick="toggleCart()" class="nav-item" style="position:relative;">
            <i class="fas fa-shopping-bag"></i>
            <span id="cart-count" style="position:absolute; top:-2px; right:5px; background:red; color:white; border-radius:50%; width:15px; height:15px; font-size:9px; display:flex; align-items:center; justify-content:center;">0</span>
            Cart
        </a>
        <a href="#" class="nav-item"><i class="fas fa-user"></i>Me</a>
    </div>

    <div class="overlay" id="overlay" onclick="closeDetails()"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDwhyU5BrtjRhy-45rd5oYfzGO8abehUiM",
            authDomain: "shopeasy-14890.firebaseapp.com",
            projectId: "shopeasy-14890",
            storageBucket: "shopeasy-14890.firebasestorage.app",
            messagingSenderId: "45827037951",
            appId: "1:45827037951:web:545d41703780fa51018aca"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let cart = [];

        // --- TIMER LOGIC ---
        function startTimer(duration) {
            let timer = duration, hours, minutes, seconds;
            setInterval(() => {
                hours = parseInt(timer / 3600, 10);
                minutes = parseInt((timer % 3600) / 60, 10);
                seconds = parseInt(timer % 60, 10);

                hours = hours < 10 ? "0" + hours : hours;
                minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;

                document.getElementById('countdown').textContent = hours + ":" + minutes + ":" + seconds;

                if (--timer < 0) timer = duration;
            }, 1000);
        }
        startTimer(14400); // 4 Hour Flash Sale

        onSnapshot(collection(db, "products"), (snapshot) => {
            const container = document.getElementById('products-container');
            container.innerHTML = "";
            snapshot.forEach((doc) => {
                const p = doc.data();
                const fakeOldPrice = (p.price * 1.3).toLocaleString(); // Show 30% higher original price
                container.innerHTML += `
                    <div class="product-card" data-cat="${p.category}" onclick="showDetails('${p.name}', '${p.price}', '${p.image}', '${p.description || 'Verified Quality.'}')">
                        <div class="flash-tag">⚡ FLASH DEAL</div>
                        <img src="${p.image}" class="product-img">
                        <div class="product-info">
                            <p style="font-size:13px; font-weight:bold; height:35px; overflow:hidden;">${p.name}</p>
                            <div class="price">MK ${Number(p.price).toLocaleString()}<span class="old-price">MK ${fakeOldPrice}</span></div>
                        </div>
                    </div>`;
            });
        });

        window.filterCat = (cat, btn) => {
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.querySelectorAll('.product-card').forEach(card => {
                card.style.display = (cat === 'All' || card.dataset.cat === cat) ? 'block' : 'none';
            });
        };

        window.showDetails = (name, price, img, desc) => {
            document.getElementById('d-name').innerText = name;
            document.getElementById('d-price').innerText = "MK " + Number(price).toLocaleString();
            document.getElementById('d-img').src = img;
            document.getElementById('d-desc').innerText = desc;
            document.getElementById('d-add-btn').onclick = () => { 
                cart.push({name, price}); 
                document.getElementById('cart-count').innerText = cart.length;
                alert('Added to Cart!'); 
                closeDetails(); 
            };
            document.getElementById('detail-panel').classList.add('active');
            document.getElementById('overlay').classList.add('active');
        };

        window.closeDetails = () => {
            document.getElementById('detail-panel').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        };

        window.whatsappChat = () => {
            const name = document.getElementById('d-name').innerText;
            window.open(`https://wa.me/265899195843?text=Hi ShopEasy, I'm interested in the Flash Sale for the ${name}.`);
        };
    </script>
</body>
</html>
